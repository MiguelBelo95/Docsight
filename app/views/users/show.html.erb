<div class="container flexbox-wrapper mt-5" >

  <div class="container doctors-details">
    <div class="show-page-card">
      <div class="show-page-photo-card">
        <% image_tag @doctor.image_url %>
        <p></p>
        <h2><%= @doctor.first_name %> <%= @doctor.last_name %></h2>
        <p> Specialty: <%= @doctor.specialty %></p>
        <p> Location: <%= @doctor.locations.last.address%></p>
        <%# <a href="/new_user_appointment" class="button">Book</a> %>
      </div>

      <div class="show-page-calendar-card">
      <%# 1. Controller to instantiate a Controller 2. Data-Target replaces the querySelector 3. Data-Action == eventListener %>
        <div class="calendar d-flex justify-content-between">
          <%# <input type="text" placeholder="Select Date.." data-controller="datepicker"> %>
          <%= form_with url: booking_appointment_path(
            params[:id],
            appointment_date: params[:appointment_date],
            procedure_id: params[:procedure_id],
            ), method: :get do |f| %>
            <div class="calendar-wrapper">
              <%= f.text_field :appointment_date,
                value: params[:appointment_date],
                class: "form-control",
                hidden: true,
                placeholder: "Type a keyword",
                # The Controller should Listen for a submit and capture the params[:appointment_date]
                data: { controller: "datepicker" }
              %>
              <div class="category-wrapper">
                <% @doctor.procedures.each do |procedure| %>
                  <div class="category-item">
                    <%= f.radio_button :procedure_id, procedure.id, class: 'form-check-input radio_buttons required category-selector', data: { style: 'ruby' }, id: "snippet_category_id_#{procedure.id}" %>
                    <%= f.label "snippet_category_id_#{procedure.id}", procedure.name, class: 'form-check-label collection_radio_buttons' %>
                  </div>
                <% end %>
              </div>
            </div>
            <%# We need to add a Procedure dropdown to get its duration %>
            <%= submit_tag "Check Availability", class: "btn btn-primary mt-3"
              %>
          <% end %>
        </div>
      </div>
    </div>


    <div class="doctor-details-card">
      <h1>Bio-card</h1>

      <div class="inner">
          <div><p>Establishment : <%= @doctor.specialty %></p></div>
          <div><p>Year : ü§Ø</p></div>
      </div>


        <div class="expertise">
          <p>Expertise & Procedures : <%= @doctor.bio %> </p>
        </div>


    </div>

    <div class="doctor-details-card">
      <h1>Pricing</h1>
      <% @doctor.procedures.each do |procedure| %>

        <p>Name: <%= procedure.name%></p> <p>Cost: ¬£ <%= procedure.price %> üí∑</p>
        <p>Duration: <%= procedure.duration %> mins ‚è≥ </p>
      <% end %>
    </div>

    <div class="doctor-details-card">
      <h1>Location</h1>
      <% @doctor.locations.each do |location| %>
        üìç
        <%= location.name %>
        <%= location.address %>
      <% end %>
    </div>

    <%# ---------REVIEW CARD----START------------ %>
    <%# ---------FROM usercontroller.rb------- %>
    <div class="doctor-details-card">
    <h1>Reviews</h1>
      <% @reviews.each do |review| %>
      <p>Rating : <%= review.rating %></p>
      <p>Comment : <%= review.comment %></p>

      <% end %>
    </div>
    <%# -----------REVIEW---CARD-----END----------- %>
  </div>

  <%# --------MAP----DIV BELOW------------- %>
  <div class="sticky" style="width: 100%; height: 600px;"
      data-controller="map"
      data-map-markers-value="<%= @markers.to_json %>"
      data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
    </div>
  <%# -------------MAP----DIV-----END------------- %>




  <!-- Modal -->
  <div class="modal modal-lg fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body d-flex">
          <div class="show-page-photo-card mx-3">
            <%= image_tag @doctor.image_url %>
            <h2 class="my-3"><strong>Dr.<%= @doctor.first_name %> <%= @doctor.last_name %></strong></h2>
            <h2><%= @doctor.specialty %></h2>
          </div>
          <div>
            <h5>Summary:</h5>
            <% if params[:procedure_id] %>
              <ul>
                <li>Appointment for: <%= @real_procedure.name %></li>
                <li>Duration: <%= @real_procedure.duration%> minutes</li>
                <li>Cost: ¬£<%= number_with_delimiter(@real_procedure.price)%></li>
              </ul>
            <% end %>
          </div>
        </div>
        <div class="modal-body border-top">
          <%= simple_form_for [@doctor, @appointment] do |f| %>
            <%= f.input :start_time, as: :time, html5: true, input_html: { value: @date } %>
            <%# <%= f.input :end_time, as: :time, html5: true, input_html: { value: @date } %>
            <%= hidden_field_tag 'date', @date %>
            <%= hidden_field_tag 'procedure', @procedure %>
            <%= hidden_field_tag 'doctor_appointments', @doctor_appointments %>
            <%= f.input :symptoms %>
            <%= f.input :additional_details %>
            <%= f.submit "Checkout", class: "btn btn-primary" %>
          <% end %>
        </div>
      </div>
    </div>
</div>
